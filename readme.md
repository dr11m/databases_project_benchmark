## В данном репозитории я планирую сравнить timescaleDB и mongoDB для чтения и записи


<details>
  <summary>два основных сценария для теста:</summary>

>эти сценарии и есть моя основная нагрузка и сложность внутри реального проекта, для решения и были написаны эти тесты:
>1) запись 50к строк, вплоть до 500кк строк 
>2) так как в таблице будет примерно 100к уникальных id, указывающих на имена предметов, то на 1 предмет будет приходится примерно 5к записей, тут я и хочу проверить, на сколько шустро я буду получать эти 5к записей для каждого предмета, по мере заполнения таблицы
</details>

---

<details>
<summary>порядок проведения теста:</summary>

- Создать контейнер в Docker для каждой базы данных
- Сформировать таблицу с колонками: item_id, order_price, sale_price, date_added
- Создать код в Python для сравнения скоростей выполнения двух наших сценариев (брать средние значения результатов, чтобы исключить выбросы и получить объективное сравнение), вот подробные сценарии тестов:
    1) Оценить, как меняется скорость записи по мере заполнения таблицы, при каждом добавлении 50к строк
    2) Оценить, как быстро он может запихивать эти 50к строк (это не нужно для проектной задачи, но интересно)
    3) На сколько быстро я могу получать данные для каждого уникального предмета, при полном заполнении таблицы таких возвращаемых строк для каждого уникального id должно быть примерно 5к, а уникальных предметов примерно 100к (получить предельную скорость получения для каждой БД)
    4) Сравнить эту скорость при разном заполнении таблицы, для 1кк строк, 100кк и предельном в 500кк строк
    5) Отрисовать графики скоростей в matplotlib и агрегировать информацию о результатах в файл
</details>

---

<details>
  <summary>как запустить тест:</summary>

- создаем образ для тестируемой БД и запускаем контейнер (инструкции в комментариях в Dockerfil'ах)
- переходим в раздел с БД и запускаем код (для timescaleDB один файл, для mongoDB два разных (чтение и запись))
  
</details>

>
---
>

<details>
  <summary style="font-weight: bold;">Результаты тестов:</summary>
  <ul>
    <li>
      <details>
        <summary>Результат для timescaleDB (одна таблица):</summary>
        1) скорсть вставки в зависимости от размера таблицы (минимальный размер - 2.5кк, максимальный - 250кк)
        <p> </p>
        <ul>2.5кк строк</ul>
        <img src="timescaleDB\results\time_to_insert_at_size_3kk.png" alt="описание_изображения">
        <ul>125кк строк</ul>
        <img src="timescaleDB\results\time_to_insert_at_size_125kk.png" alt="описание_изображения">
        - минимальные выбросы, среднее время по-прежнему ~0.2 секунды
        <ul>250кк строк</ul>
        <img src="timescaleDB\results\time_to_insert_at_size_250kk.png" alt="описание_изображения">
        >> По итогу скорость добавления практически никак не менялась от 2кк до 500кк строк.
        <p> </p>
        2) скорсть получения всех строк по уникальному item_id в зависимости от размера таблицы (минимальный размер - 2.5кк, максимальный - 250кк). Уникальных item_id 100к, на каждый при максимальной загруженности приходится ~5к строк.
        <p></p>
        <ul>2.5кк строк</ul>
        <img src="timescaleDB\results\time_to_select_data_for_unique_id_table_size_was_3kk.png" alt="описание_изображения">
        <ul>125кк строк</ul>
        <img src="timescaleDB\results\time_to_select_data_for_unique_id_table_size_was_125kk.png" alt="описание_изображения">
        <ul>250кк строк</ul>
        <img src="timescaleDB\results\time_to_select_data_for_unique_id_table_size_was_250kk.png" alt="описание_изображения">
        >> Тут уже четко видна зависимость количества строк в таблице и среднего времени для ответа на запрос (от 0.002сек. при 2.5кк строк до 1.2сек. при 500кк строк)
      </details>
    </li>
  </ul>

  <ul>
    <li>
      <details>
        <summary>Результат для mongoDB:</summary>
        1) Средняя скорость для добавления 50к строк была примерно 0.3 секунды и не менялась от 3кк строк до 500кк строк (примерно схожие результаты у timescaleDB)
        <p></p>
        2) Средняя скорость получения всех строк по уникальному item_id в зависимости от размера таблицы составила примерно 20 секунд и увеличивалась по мере роста числа записей в БД (минимальный размер - 2.5кк, максимальный - 500кк).
        <p></p>
        P.S. Именно поэтому я и не стал запариваться с картинками и описанием, так как результат для чтения слишком плачевный (в 10 раз медленнее чем timescaleDB)
      </details>
    </li>
  </ul>
</details>


#TODO разделить timescaledb на 4 таблицы и добавлять последовательно в каждую, на записи параллельно отправлять запрос в 4 таблицы